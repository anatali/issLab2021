package unibo.qakexampleobserver;

import org.apache.log4j.BasicConfigurator;
import org.eclipse.californium.core.CoapClient;
import org.eclipse.californium.core.CoapHandler;
import org.eclipse.californium.core.CoapObserveRelation;
import org.eclipse.californium.core.CoapResponse;
import unibo.comm22.utils.ColorsOut;
import unibo.comm22.utils.CommUtils;

public class WasteServiceObserver {
    private CoapObserveRelation relation = null;
    private CoapClient client = null;

    public WasteServiceObserver(){
        /*
        new Thread(){
            public void run(){
                client = new CoapClient("coap://localhost:8013/ctxWasteService/wasteservice");
            }
        }.start();
    */
        client = new CoapClient("coap://localhost:8013/ctxwasteservice/wasteservice");
        observe( );
    }

    public void  observe( ) {
        ColorsOut.outappl("Observer observe " + client , ColorsOut.CYAN);
        relation = client.observe(
                new CoapHandler() {
                    @Override public void onLoad(CoapResponse response) {
                        String content = response.getResponseText();
                        ColorsOut.outappl("ActorObserver | value=" + content, ColorsOut.GREEN);
                    }
                    @Override public void onError() {
                        ColorsOut.outerr("OBSERVING FAILED (press enter to exit)");
                    }
                });
    }

    public static void main( String[] args ){
        //BasicConfigurator.configure(); //For slf4j
        new WasteServiceObserver();
        CommUtils.delay(60*10*1000);
        ColorsOut.outappl("Observer ENDS " , ColorsOut.CYAN);
    }
}
